name: evpn-lab

topology:
  kinds:
    srl:
      # Need IXR D2 or D3 for EVPN/VXLAN support
      type: ixrd2 # See https://www.nokia.com/networks/products/7250-interconnect-router/
      # Uses custom container image containing auto-config agent
      # image: registry.srlinux.dev/pub/srlinux # latest, or srlinux:21.3.1-410
      image: srl/auto-config:latest
      #binds:
      # Must be owned by user:group 1001:1001 with 644 permissions
      #- ./authorized_keys:/home/linuxadmin/.ssh/authorized_keys:ro
      # Patched sshd_config to enable global authorized_keys file; must be owned by root
      #- ./authorized_keys:/authorized_keys:ro
    linux:
      image: frr-with-lldp:latest # Custom built image with lldpad and daemons included

  nodes:
    leaf1:  { kind: srl, startup-config: auto-leaf.cfg.json } # TODO test 'auto'
    leaf2:  { kind: srl, startup-config: auto-leaf.cfg.json }
    spine1: { kind: srl, startup-config: auto-spine.cfg.json }

    #h1: { kind: srl, config: auto-host-with-vip.cfg.json }
    #h2: { kind: srl, config: auto-host-with-vip.cfg.json }
    h1:
      kind: linux

    h2:
      kind: linux

  links:
    - endpoints: ["leaf1:e1-1","spine1:e1-1"]
    - endpoints: ["leaf2:e1-1","spine1:e1-2"]

    - endpoints: ["h1:e1-1","leaf1:e1-3"]
    - endpoints: ["h1:e1-2","leaf2:e1-3"] # lag
    - endpoints: ["h2:e1-1","leaf2:e1-4"]
